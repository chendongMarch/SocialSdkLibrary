# SocialSdk

![ç™»å½•åˆ†äº«](http://olx4t2q6z.bkt.clouddn.com/17-12-1/62754706.jpg)

ğŸ‰  2017.12.12 å¯¹ä»£ç è¿›è¡Œç®€å•é‡æ„å¹¶æµ‹è¯•ï¼Œå‘å¸ƒç¬¬ä¸€ä¸ªç¨³å®šç‰ˆæœ¬ 1.0.0

ã€Œ`SocialSdk`ã€ æä¾›å¾®åšã€å¾®ä¿¡ã€QQçš„ç™»é™†åˆ†äº«åŠŸèƒ½æ”¯æŒï¼Œä½¿ç”¨ å¾®åšã€QQã€å¾®ä¿¡ åŸç”Ÿ SDK æ¥å…¥ï¼ŒæŒç»­ä¼˜åŒ–ä¸­...

ç”±äºé¡¹ç›®ä¸­æƒ³è¦æ¥å…¥çš„å¹³å°å› äººè€Œå¼‚ï¼Œç¬¬ä¸‰æ–¹ SDK æ›´æ–°ä¹Ÿæ¯”è¾ƒé¢‘ç¹ï¼Œå› æ­¤æ²¡æœ‰å¯¹ç±»åº“è¿›è¡Œå‘å¸ƒæ“ä½œï¼Œæœ¬é¡¹ç›®æ˜¯ä¸ª `Library Module`ï¼Œæµ‹è¯•ä»£ç çš„ `sample` æˆ‘æ²¡æœ‰å‘ä¸ä¸Šæ¥ï¼Œä¸‹è½½ä¹‹åç›´æ¥ä¾èµ–è¿™ä¸ª `module` å³å¯ï¼Œè¿™æ ·ä¹Ÿæ–¹ä¾¿é—®é¢˜ä¿®å¤ã€‚

é¡¹ç›®åœ°å€ : [GitHub - SocialSdkLibrary](https://github.com/chendongMarch/SocialSdkLibrary)

æ¨èé˜…è¯» ï¼š[æ–‡ç« åœ°å€](http://cdevlab.top/article/3067853428/)

<!--more-->

## ä¼˜ç‚¹

å†™çš„ä¸å¥½ï¼Œè¿˜åœ¨ä¼˜åŒ–ä¸­...

ğŸ”¥ ç®€å•ï¼šåªéœ€è¦å…³æ³¨å‡ ä¸ªç®¡ç†ç±»å’Œç›¸å…³æ•°æ®çš„æ„é€ å³å¯å®ç°æ‰€éœ€åŠŸèƒ½ï¼Œä¸éœ€è¦è€ƒè™‘å¤æ‚çš„æˆæƒå’Œåˆ†äº«é€»è¾‘ã€‚

ğŸ”¥ è½»é‡ï¼šé™¤äº†å¿…é¡»çš„ç¬¬ä¸‰æ–¹ sdk ä¹‹å¤–ï¼Œæœ¬é¡¹ç›®åªä¾èµ–äº†ä¸€ä¸ªç®€å•çš„å¼‚æ­¥ä»»åŠ¡çš„æ¡†æ¶-bolts (38k)ï¼Œåç»­ä¼šè€ƒè™‘ä¹Ÿå‰”é™¤æ‰ï¼Œä¸å¼•å…¥æ— ç”¨ä¾èµ–ï¼Œä¿è¯ä¸å®¿ä¸»é¡¹ç›®é«˜åº¦ç»Ÿä¸€ã€‚

ğŸ”¥ å…¨é¢ï¼šå†…éƒ¨å­˜å‚¨æˆæƒ tokenï¼Œé¿å…å¤šæ¬¡æˆæƒï¼›å¯¹qqã€å¾®ä¿¡ã€å¾®åšåšäº†å®Œå–„çš„æ”¯æŒï¼›

ğŸ”¥ æ‰©å±•æ€§ï¼šé¡¹ç›®ä»¥åŠŸèƒ½è¿›è¡Œåˆ’åˆ†ï¼Œå„ä¸ªå¹³å°ä¹‹é—´äº’ç›¸ç‹¬ç«‹ï¼Œå¦‚æœæƒ³ä»…æ”¯æŒéƒ¨åˆ†å¹³å°ï¼Œåªéœ€è¦åˆ é™¤æŸä¸ªå¹³å°çš„å…·ä½“å®ç°å³å¯ã€‚å¯ä»å¤–éƒ¨æ³¨å…¥ä»£ç†ï¼Œå¯¹ä¸€äº›åŠŸèƒ½è¿›è¡Œè‡ªå®šä¹‰çš„æ‰©å±•ã€‚

ğŸ”¥ åŠŸèƒ½æ€§ï¼šé’ˆå¯¹å®é™…é¡¹ç›®éœ€æ±‚è¿›è¡Œæ‰©å±•ï¼Œä¾‹å¦‚åœ¨åˆ†äº«å‰ç»Ÿä¸€å¯¹åˆ†äº«æ•°æ®æä¾›ä¸€æ¬¡é‡æ–°æ„é€ çš„æœºä¼šã€‚

ğŸ”¥ å…¼å®¹æ€§ï¼šä¸ºå¤šä¸ªå¹³å°æä¾›å¤–è§‚ä¸€è‡´çš„åˆ†äº«æ¥å£ï¼Œè‹¥ä¸æ”¯æŒï¼Œä½¿ç”¨ web åˆ†äº«å…¼å®¹ã€‚æ”¯æŒç›´æ¥ä½¿ç”¨ç½‘ç»œå›¾ç‰‡åˆ†äº«ï¼Œå†…ç½®è‡ªåŠ¨ä¸‹è½½åŠŸèƒ½ã€‚ä½¿ç”¨ Intent å…¼å®¹ä¸æ”¯æŒçš„æ•°æ®æ¨¡å¼ï¼Œå¦‚æ”¯æŒæœ¬åœ°è§†é¢‘åˆ†äº«ï¼Œqq çš„çº¯æ–‡å­—åˆ†äº«ç­‰ç­‰ã€‚

## ä¸»è¦ç±»æ–‡ä»¶

ä½¿ç”¨ **SocialSdk** åªéœ€è¦å…³æ³¨ä»¥ä¸‹å‡ ä¸ªæ–‡ä»¶ï¼š

ğŸ‘‰ï¸ `SocialSdk.java` ç»“åˆ `SocialConfig.java` ç”¨æ¥è¿›è¡Œæˆæƒä¿¡æ¯çš„é…ç½®ã€‚

ğŸ‘‰ï¸ `Target.java` ç±»æ˜¯å•ç‹¬åˆ†ç¦»å‡ºæ¥çš„å¸¸é‡ç±»ï¼ŒæŒ‡å‘äº†ç™»å½•å’Œåˆ†äº«çš„å…·ä½“ç›®æ ‡ã€‚

ğŸ‘‰ï¸ `LoginManager.java` ç”¨æ¥å®ç° qqã€å¾®ä¿¡ã€å¾®åšç¬¬ä¸‰æ–¹æˆæƒç™»å½•ï¼Œå†…éƒ¨å­˜å‚¨ `accessToken`ï¼Œæ— éœ€å¤šæ¬¡æˆæƒï¼Œåªè¦è°ƒç”¨ `LoginManager.login()` æ–¹æ³•ã€‚

ğŸ‘‰ï¸ï¸ `ShareManager.java` ç”¨æ¥å®ç° 9 ç§æ•°æ®ç±»å‹ã€3 å¤§å¹³å°ã€7 ä¸ªæ¸ é“çš„åˆ†äº«ï¼Œåªè¦è°ƒç”¨ `ShareManager.share()` æ–¹æ³•ã€‚


## gradle é…ç½®

é’ˆå¯¹å¤šæ–¹ `SDK` çš„è¦æ±‚ï¼Œå¯¹æƒé™ã€å’Œå¿…è¦çš„ç•Œé¢ã€æœåŠ¡éƒ½å·²ç»åœ¨ç±»åº“ä¸­è¿›è¡Œäº†é…ç½®ï¼Œå½“ä¾èµ–è¯¥ç±»åº“æ—¶ï¼Œä¼šè‡ªåŠ¨åˆå¹¶ï¼Œä¸è¿‡ä»ç„¶è¿˜éœ€è¦åœ¨é¡¹ç›®çš„ `app/build.gradle` ä¸­é…ç½®å¯¹åº”çš„ `qqId` çš„ `manifestPlaceholders`ï¼Œä»£ç å¦‚ä¸‹ï¼š

```gradle
defaultConfig {
	manifestPlaceholders = [qq_id: "11049xxxxx"]
}
```
å…³äº `manifestPlaceholders` çš„ä½¿ç”¨

```bash
å½“ä½¿ç”¨ manifestPlaceholders = [qq_id: "11049xxxxx"] çš„æ–¹å¼æ—¶ï¼Œä¹‹å‰å£°æ˜çš„æ‰€æœ‰ manifestPlaceholders éƒ½ä¼šè¢«æ›¿æ¢æ‰ï¼Œåªä¿ç•™æœ€åçš„ã€‚

å½“ä½¿ç”¨ manifestPlaceholders.qq_id = "11049xxxxx" çš„æ–¹å¼æ—¶ï¼Œä¼šåœ¨åŸæ¥çš„ manifestPlaceholders ä¸­è¿½åŠ æ–°çš„ï¼ŒåŒæ—¶ä¹Ÿä¿ç•™ä»¥å‰çš„ã€‚

å»ºè®®çš„æ–¹å¼æ˜¯ï¼Œåœ¨ defaultConfig ä¸­ä½¿ç”¨ç›´æ¥èµ‹å€¼çš„æ–¹å¼ï¼Œè€Œåœ¨ buildTypes å’Œ Favors ä¸­ä½¿ç”¨è¿½åŠ çš„æ–¹å¼ï¼Œé¿å…å°†ä¹‹å‰çš„è¦†ç›–æ‰ã€‚
```


## åˆå§‹åŒ–

ä½ éœ€è¦åœ¨ä½¿ç”¨ SDK ä¹‹å‰è¿›è¡Œåˆå§‹åŒ–æ“ä½œï¼Œå»ºè®®æ”¾åœ¨ `Applicaton` ä¸­è¿›è¡Œã€‚


```java
String qqAppId = getString(R.string.QQ_APPID);
String wxAppId = getString(R.string.WEICHAT_APPID);
String wxSecretKey = getString(R.string.WEICHAT_APPKEY);
String sinaAppId = getString(R.string.SINA_APPKEY);

SocialSdkConfig config = new SocialSdkConfig(this)
        // é…ç½®qq
        .qq(qqAppId)
        // é…ç½®wx
        .wechat(wxAppId, wxSecretKey)
        // é…ç½®sina
        .sina(sinaAppId)
        // é…ç½®Sinaçš„RedirectUrlï¼Œæœ‰é»˜è®¤å€¼ï¼Œå¦‚æœæ˜¯å®˜ç½‘é»˜è®¤çš„ä¸éœ€è¦è®¾ç½®
        .sinaRedirectUrl("http://open.manfenmm.cxxxxxxx")
        // é…ç½®Sinaæˆæƒscope,æœ‰é»˜è®¤å€¼ï¼Œé»˜è®¤å€¼ all
        .sinaScope(SocialConstants.SCOPE);

// ğŸ‘® æ·»åŠ è‡ªå®šä¹‰çš„ json è§£æï¼Œå¿…é¡»
SocialSdk.addJsonAdapter(new GsonJsonAdapter());
// ğŸ‘® æ·»åŠ  config æ•°æ®ï¼Œå¿…é¡»
SocialSdk.init(config);
```

## adapter

ä½¿ç”¨ `adapter` è¿™ç§æ¨¡å¼ä¸»è¦å‚ç…§äº†ä¸€äº›æˆç†Ÿçš„ç±»åº“ï¼Œç›®çš„æ˜¯ä¸ºäº†å¯¹å¤–æä¾›æ›´å¥½çš„æ‰©å±•æ€§ï¼Œè¿™éƒ¨åˆ†å†…å®¹å¯ä»¥å…³æ³¨ `SocialSdk.java`.

- `IJsonAdapter`ï¼Œè´Ÿè´£ `Json` è§£æï¼Œä¸ºäº†ä¿æŒå’Œå®¿ä¸»é¡¹ç›® `json` è§£ææ¡†æ¶çš„ç»Ÿä¸€ï¼Œæ˜¯å¿…é¡»è‡ªå®šä¹‰æ·»åŠ çš„ï¼ˆæ²¡æœ‰å†…ç½®ä¸€ä¸ªå®ç°æ˜¯å› ä¸ºä½¿ç”¨è‡ªå¸¦çš„ `JsonObject` è§£æå®åœ¨éº»çƒ¦ï¼Œåˆä¸æƒ³å†…ç½®ä¸€ä¸ªä¸‰æ–¹åº“è¿›æ¥ï¼Œé‡‡å–çš„è¿™ç§æŠ˜è¡·æ–¹æ¡ˆï¼‰ï¼Œæä¾›ä¸€ä¸ª `Gson` ä¸‹çš„å®ç°ä»…ä¾›å‚è€ƒ - [GsonJsonAdapter.java](https://github.com/chendongMarch/SocialSdkLibrary/blob/master/temp/GsonJsonAdapter.java)

- `IRequestAdapter`ï¼Œè´Ÿè´£è¯·æ±‚æ•°æ®ï¼Œç›®å‰å¾®ä¿¡çš„ `OAuth2` æˆæƒå’Œå›¾ç‰‡ä¸‹è½½çš„ç›¸å…³è¯·æ±‚éƒ½æ˜¯ä½¿ç”¨ `IRequestAdapter` ä»£ç†ï¼Œå·²ç»ä½¿ç”¨ `URLConnection` å†…ç½®äº†ä¸€ä¸ªå®ç°ï¼Œå¦‚æœä½ æœ‰è‡ªå·±çš„éœ€æ±‚å¯ä»¥é‡å†™è¿™éƒ¨åˆ†ï¼Œæ³¨æ„ `https` è¯·æ±‚çš„å…¼å®¹ï¼Œå¯ä»¥å‚è€ƒ - [RequestAdapterImpl.java](https://github.com/chendongMarch/SocialSdkLibrary/blob/master/src/main/java/com/march/socialsdk/adapter/impl/RequestAdapterImpl.java)

## ç™»å½•åŠŸèƒ½

ç™»é™†åŠŸèƒ½æ”¯æŒä¸‰ä¸ªå¹³å°ï¼Œqqï¼Œå¾®ä¿¡ï¼Œå¾®åšï¼›

```java
// 3ä¸ªå¹³å°
Target.LOGIN_QQ;
Target.LOGIN_WX;
Target.LOGIN_WB;
```

ä½¿ç”¨ `OnLoginListener` ç›‘å¬ç™»å½•è¿”å›ç»“æœï¼Œè¿”å›çš„ `LoginResult` ä¸­ä¸»è¦åŒ…æ‹¬ç™»å½•ç±»å‹ï¼ŒåŸºæœ¬ç”¨æˆ·ä¿¡æ¯ï¼Œä»¤ç‰Œä¿¡æ¯ 3 éƒ¨åˆ†ã€‚

```java
public class LoginResult {
    // ç™»é™†çš„ç±»å‹ï¼Œå¯¹åº” Target.LOGIN_QQ ç­‰ã€‚ã€‚ã€‚
    private int             type;
    // è¿”å›çš„åŸºæœ¬ç”¨æˆ·ä¿¡æ¯
    // é’ˆå¯¹ç™»å½•ç±»å‹å¯å¼ºè½¬ä¸º WbUser,WxUser,QQUser æ¥è·å–æ›´åŠ ä¸°å¯Œçš„ä¿¡æ¯
    private BaseUser        mBaseUser;
    // æœ¬æ¬¡ç™»é™†çš„ token ä¿¡æ¯ï¼Œopenid,unionid,token,expires_in
    private BaseAccessToken mBaseToken;
}

// ç™»é™†ç»“æœç›‘å¬
mOnLoginListener = new OnLoginListener() {
    @Override
    public void onLoginSucceed(LoginResult loginResult) {
        Log.e(TAG, loginResult.toString());
    }
    @Override
    public void onCancel() {
        toast("ç™»å½•å–æ¶ˆ");
    }
    @Override
    public void onException(PlatformException e) {
        toast("ç™»å½•å¤±è´¥ " + e.toString());
    }
};

// 3ä¸ªå¹³å°
Target.LOGIN_QQ;
Target.LOGIN_WX;
Target.LOGIN_WB;

// å”¤é†’ç™»é™†
LoginManager.login(mActivity, Target.LOGIN_QQ, mOnLoginListener);
```

æ¸…é™¤æˆæƒ `token`ï¼Œä¸ºäº†é¿å…æ¯æ¬¡ç™»å½•éƒ½è¦æ±‚ç”¨æˆ·æ‰“å¼€æˆæƒç•Œé¢é‡æ–°ç‚¹å‡»æˆæƒçš„ä¸å¥½ä½“éªŒï¼Œç±»åº“é‡Œé¢å¯¹ `token` è¿›è¡Œäº†æŒä¹…åŒ–çš„å­˜å‚¨ï¼Œå½“æœ¬åœ° `token` æ²¡æœ‰è¿‡æœŸæ—¶ï¼Œç›´æ¥ä½¿ç”¨è¿™ä¸ª `token` å»è¯·æ±‚ç”¨æˆ·ä¿¡æ¯ï¼ŒåŒæ—¶æä¾›äº†æ¸…é™¤æœ¬åœ° `token` çš„æ–¹æ³•ã€‚

```java
LoginManager.java

// æ¸…é™¤å…¨éƒ¨å¹³å°çš„ token
public static void clearAllToken(Context context)
// æ¸…é™¤æŒ‡å®šå¹³å°çš„ token
public static void clearToken(Context context, @Target.LoginTarget int loginTarget)
```

## åˆ†äº«åŠŸèƒ½


### æ‰©å±•æ”¯æŒ

```java
// å‘çŸ­ä¿¡
ShareManager.sendSms(mActivity,"13612391817","msg body");
// å‘é‚®ä»¶
ShareManager.sendEmail(mActivity,"1101873740@qq.com","subject","msg body");
// æ‰“å¼€æ¸ é“å¯¹åº”åº”ç”¨
ShareManager.openApp(mActivity,Target.SHARE_QQ_FRIENDS);
```

### 9 ç§æ•°æ®æ”¯æŒ

åˆ†äº«æ”¯æŒ 9 ç§ç±»å‹çš„æ•°æ®ï¼›å¦‚æœæŸä¸ªå¹³å°ä¸å…¼å®¹æŸç§ç±»å‹çš„åˆ†äº«ï¼Œå°†ä¼šä½¿ç”¨ `web` åˆ†äº«çš„æ–¹å¼ä»£æ›¿ï¼›æ¯”å¦‚å¾®ä¿¡ä¸æ”¯æŒ `app` åˆ†äº«ï¼Œåˆ†äº«å‡ºå»ä¹‹åæ—¶ `web` åˆ†äº«çš„æ¨¡å¼ã€‚æ”¯æŒçš„ 9 ç§ç±»å‹åˆ†åˆ«æ˜¯ï¼š

> 1. å¼€å¯æ¸ é“å¯¹ç”¨çš„ appã€‚
> 2. åˆ†äº«æ–‡å­—ã€‚
> 3. åˆ†äº«å›¾ç‰‡( jpg , png , gif )ã€‚
> 4. åˆ†äº« appã€‚
> 5. åˆ†äº« webã€‚
> 6. åˆ†äº« musicã€‚
> 7. åˆ†äº« videoã€‚
> 8. åˆ†äº«æœ¬åœ° videoï¼Œä½¿ç”¨ Intent æ–¹å¼å”¤é†’ã€‚
> 9. åˆ†äº« voiceï¼Œ(sina ä¸“æœ‰ï¼Œå…¶ä»–å¹³å°ä½¿ç”¨ web åˆ†äº«)


### 7 ä¸ªåˆ†äº«æ¸ é“

```java
// æ”¯æŒçš„åˆ†äº«æ¸ é“
Target.SHARE_QQ_FRIENDS; // qqå¥½å‹
Target.SHARE_QQ_ZONE; // qqç©ºé—´
Target.SHARE_WX_FRIENDS; // å¾®ä¿¡å¥½å‹
Target.SHARE_WX_ZONE; // å¾®ä¿¡æœ‹å‹åœˆ
Target.SHARE_WX_FAVORITE; // å¾®ä¿¡æ”¶è—
Target.SHARE_WB_NORMAL; // æ–°æµªå¾®åš
Target.SHARE_WB_OPENAPI; // æ–°æµªå¾®åšopenApiåˆ†äº«ï¼Œä½¿ç”¨è¯¥æ–¹æ³•åˆ†äº«å›¾ç‰‡æ—¶å¾®åšåé¢ä¼šå¸¦ä¸€ä¸ªå°å°¾å·´ï¼Œå¯ä»¥ç‚¹å‡»è¿›å…¥å®˜å¾®
```

### åˆ›å»ºåˆ†äº«æ•°æ®

åˆ†äº«æ—¶ï¼Œæˆ‘ä»¬é¦–å…ˆè¦æ„é€ åˆ†äº«ç”¨çš„æ•°æ®ï¼Œ`ShareObj` å¯¹è±¡æä¾›äº†å¤šç§é™æ€æ–¹æ³•ç”¨æ¥å¿«é€Ÿåˆ›å»ºå¯¹åº”åˆ†äº«çš„ç±»å‹çš„å¯¹è±¡ã€‚

```java
// æµ‹è¯•ç”¨çš„è·¯å¾„
localImagePath = new File(Environment.getExternalStorageDirectory(), "1.jpg").getAbsolutePath();
localVideoPath = new File(Environment.getExternalStorageDirectory(), "video.mp4").getAbsolutePath();
localGifPath = new File(Environment.getExternalStorageDirectory(), "3.gif").getAbsolutePath();
netVideoPath = "http://7xtjec.com1.z0.glb.clouddn.com/export.mp4";
netImagePath = "http://7xtjec.com1.z0.glb.clouddn.com/token.png";
netMusicPath = "http://7xtjec.com1.z0.glb.clouddn.com/test_music.mp3";
netMusicPath = "http://mp3.haoduoge.com/sSocialSdkConfig/2017-05-19/1495207225.mp3";
targetUrl = "http://bbs.csdn.net/topics/391545021";


// æ‰“å¼€æ¸ é“å¯¹åº”app
ShareObj shareMediaObj = ShareObj.buildOpenAppObj();
// åˆ†äº«æ–‡å­—
ShareObj textObj = ShareObj.buildTextObj("åˆ†äº«æ–‡å­—", "summary");
// åˆ†äº«å›¾ç‰‡
ShareObj imageObj = ShareObj.buildImageObj("åˆ†äº«å›¾ç‰‡", "summary", localImagePath);
// åˆ†äº«gif
ShareObj imageGifObj = ShareObj.buildImageObj("åˆ†äº«å›¾ç‰‡", "summary", localGifPath);
// åˆ†äº«app
ShareObj appObj = ShareObj.buildAppObj("åˆ†äº«app", "summary", localImagePath, targetUrl);
// åˆ†äº«web
ShareObj webObj = ShareObj.buildWebObj("åˆ†äº«web", "summary", localImagePath, targetUrl);
// åˆ†äº«è§†é¢‘
ShareObj videoObj = ShareObj.buildVideoObj("åˆ†äº«è§†é¢‘", "summary", localImagePath, targetUrl, localVideoPath, 10);
// åˆ†äº«æœ¬åœ°è§†é¢‘ï¼Œä½¿ç”¨ Intent æ–¹å¼å”¤é†’ï¼Œæ”¯æŒ qqã€å¾®ä¿¡ å¥½å‹åˆ†äº«
ShareObj videoLocalObj = ShareObj.buildVideoObjByLocalPath(localVideoPath);
// åˆ†äº«éŸ³ä¹
ShareObj musicObj = ShareObj.buildMusicObj("åˆ†äº«éŸ³ä¹", "summary", localImagePath, targetUrl, netMusicPath, 10);
// åˆ†äº«å£°éŸ³ï¼Œå¾®åšç‰¹æœ‰ï¼Œå…¶ä»–å¹³å°ä»¥webæ–¹å¼åˆ†äº«
ShareObj voiceObj = ShareObj.buildVoiceObj("åˆ†äº«å£°éŸ³", "summary", localImagePath, targetUrl, netMusicPath, 10);
```

### åˆ†äº«ç›‘å¬

åˆ†äº«ç»“æœï¼Œä½¿ç”¨ `OnShareListener` è¿›è¡Œæ£€æµ‹ã€‚`OnShareListener` æä¾›äº†ä¸°å¯Œçš„æ–¹æ³•æ¥æ”¯æŒåˆ†äº«çš„å„ä¸ªé˜¶æ®µï¼Œå…³äºåˆ†äº«å¯¹è±¡é‡æ„çš„æ“ä½œï¼Œåœ¨ä¸‹ä¸€éƒ¨åˆ†è¯´æ˜ã€‚

```
public class SimpleShareListener implements OnShareListener{
    @Override
    public void onStart(int shareTarget, ShareObj obj) {
        // åˆ†äº«å¼€å§‹
    }
    @Override
    public ShareObj onPrepareInBackground(int shareTarget, ShareObj obj) {
        // é‡æ„åˆ†äº«å¯¹è±¡ï¼Œä¸éœ€è¦æ—¶è¿”å› null å³å¯
        return null;
    }
    @Override
    public void onSuccess() {
        // åˆ†äº«æˆåŠŸ
    }
    @Override
    public void onFailure(SocialException e) {
        // åˆ†äº«å¤±è´¥
    }
    @Override
    public void onCancel() {
        // åˆ†äº«å–æ¶ˆ
    }
}
```

### å‘èµ·åˆ†äº«

```java
// å”¤é†’åˆ†äº«
ShareManager.share(mActivity, Target.SHARE_QQ_FRIENDS, imageObj, mOnShareListener);
```

### é‡å†™åˆ†äº«å¯¹è±¡

å…³äºé‡å†™åˆ†äº«å¯¹è±¡ï¼Œå…¶å®æä¾›ä¸€ç§èƒ½åœ¨åˆ†äº«ä¹‹å‰å¯¹éœ€è¦åˆ†äº«çš„ `ShareObj` è¿›è¡Œç»Ÿä¸€å¤„ç†çš„æœºä¼šï¼Œç±»ä¼¼ä¸­é—´æ’ä¸€é“è‡ªå®šä¹‰å·¥åºï¼Œæ¯”å¦‚å¯ä»¥ç”¨æ¥è§£å†³ç½‘ç»œå›¾ç‰‡æ— æ³•åˆ†äº«ï¼Œæˆ‘ä»¬éœ€è¦å°†å®ƒä¸‹è½½åˆ°æœ¬åœ°ï¼Œåœ¨è¿›è¡Œåˆ†äº«ï¼Œåˆæ¯”å¦‚å›¾ç‰‡åˆ†äº«å‡ºå»ä¹‹å‰åŠ ä¸Š app æ°´å°ç­‰æ“ä½œã€‚

ä¸»è¦æ˜¯é‡å†™ `OnShareListener` çš„ `onPrepareInBackground` æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šåœ¨åˆ†äº«ä¹‹å‰é¦–å…ˆæ‰§è¡Œï¼Œå¦‚æœè¿”å›ä¸æ˜¯ nullï¼Œå°†ä¼šä½¿ç”¨æ–°åˆ›å»ºçš„ `ShareObj` è¿›è¡Œåˆ†äº«ï¼Œå¦å¤–ç”±äºè€ƒè™‘åˆ°å¯èƒ½è¿›è¡Œè€—æ—¶æ“ä½œï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯åœ¨å­çº¿ç¨‹æ‰§è¡Œçš„ã€‚

```java
@Override
public ShareObj onPrepareInBackground(int shareTarget,ShareObj obj) {
    // é‡æ„åˆ†äº«å¯¹è±¡ï¼Œä¸éœ€è¦æ—¶è¿”å› null å³å¯
    return null;
}
```

çœ‹ä¸€ä¸ªåŸºæœ¬çš„å®ä¾‹ï¼Œå…¶ä¸­ `ShareObjHelper.prepareThumbImagePath(obj);` æ˜¯ SDK å†…éƒ¨ä¸‹è½½æ–‡ä»¶çš„ä¸€ä¸ªæ–¹æ³•çš„å°è£…ï¼Œç”¨æ¥å°†ç½‘ç»œå›¾ä¸‹è½½åˆ°æœ¬åœ°ç„¶åæ›´æ–° `ShareObj` æŒ‡å‘çš„å›¾ç‰‡åœ°å€ï¼Œä½ å¯ä»¥ç›´æ¥ä½¿ç”¨å®ƒã€‚

```java
public class MyShareListener extends SimpleShareListener {

    public static final String TAG = MyShareListener.class.getSimpleName();

    private Context       mContext;
    private LoadingDialog mLoadingDialog;

    public MyShareListener(Context context) {
        mContext = context;
        mLoadingDialog = new LoadingDialog(mContext);
    }

    @Override
    public void onStart(int shareTarget, ShareObj obj) {
        if (mLoadingDialog != null)
            mLoadingDialog.show();
    }

    @Override
    public ShareObj onPrepareInBackground(int shareTarget, ShareObj obj) throws Exception{
        // ç½‘ç»œè·¯å¾„ï¼Œå…ˆè¿›è¡Œæ–‡ä»¶ä¸‹è½½è¿›è¡Œæ–‡ä»¶ä¸‹è½½
        ShareObjHelper.prepareThumbImagePath(obj);
        // åˆ†äº«ç…§ç‰‡ä¸”ä¸æ˜¯gifæ—¶åŠ æ°´å°
        if (obj.getShareObjType() == ShareObj.SHARE_TYPE_IMAGE
                && !FileHelper.isGifFile(obj.getThumbImagePath())) {
            File thumbImageFile = new File(obj.getThumbImagePath());
            File saveFile = new File(Constants.THUMB_IMAGE_PATH, thumbImageFile.getName());
            if (!FileUtil.fileIsExist(saveFile.getAbsolutePath())) {
                ImageUtils.drawWaterMarkSync(mContext, obj.getThumbImagePath(), saveFile.getAbsolutePath(), false, false);
            }
            obj.setThumbImagePath(saveFile.getAbsolutePath());
        }
        return obj;
    }

    @Override
    public void onSuccess() {
        ToastUtil.show("åˆ†äº«æˆåŠŸ");
    }

    @Override
    public void onFailure(SocialException e) {
        switch (e.getErrorCode()) {
            case SocialException.CODE_NOT_INSTALL:
                ToastUtil.show("åº”ç”¨æœªå®‰è£…");
                break;
        }
        L.e(TAG, "åˆ†äº«å¤±è´¥" + e.toString());
    }

    @Override
    public void onCancel() {
        ToastUtil.show("åˆ†äº«å–æ¶ˆ");
    }
}
```